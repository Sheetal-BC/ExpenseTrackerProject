<!DOCTYPE html>
<html lang="en">
<head>
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form onsubmit="saveToLocalStorage(event)">
        <h1 class="heading">Expense Tracker</h1>
        <hr>
        <label>Choose Expense Amount</label><br>
        <input id = 'amount' type="number" name="amount" required/><br>
        <label>Choose Discription</label><br>
        <input id = 'discription' type="text" name="addDiscription" required/><br>
        <label>Choose a Catagory</label><br>
        <select name="category" id="category" required>
            <option value="selection" class ="tosel">Please select an option</option>
            <option value="electricity">Electricity</option>
            <option value="movies">Movies</option>
            <option value="onVacation">On vacation</option>
            <option value="groceries">Groceries</option>
            <option value="mobilebill">Mobile Bills</option>
            <option value="emi">EMI</option>
            <option value="food">Food</option>
     </select>
          <button class="btn">Add Expenses</button>
    </form> 
    <ul id = 'listOfExpenses' class="listexpenses"></ul>  
    <script>
        function saveToLocalStorage(event) {
           event.preventDefault();
           const addAmount = event.target.amount.value;
           const discription= event.target.addDiscription.value;
           const category = event.target.category.value;
          

           const obj = {
               addAmount,
               discription,
               category
              
           }
           localStorage.setItem(obj.discription, JSON.stringify(obj))
           showNewExpenseOnScreen(obj)
       }

       window.addEventListener("DOMContentLoaded", () => {
           const localStorageObj = localStorage;
           const localstoragekeys  = Object.keys(localStorageObj)

           for(var i =0; i< localstoragekeys.length; i++){
               const key = localstoragekeys[i]
               const userDetailsString = localStorageObj[key];
               const userDetailsObj = JSON.parse(userDetailsString);
               showNewExpenseOnScreen(userDetailsObj)
           }
       })

       function showNewExpenseOnScreen(user){
           document.getElementById('discription').value = '';
           document.getElementById('amount').value = '';
           document.getElementById('category').value ='';
         


           const parentNode = document.getElementById('listOfExpenses');
           const childHTML = `<li id=${user.discription} > ${user.addAmount} - ${user.discription} - ${user.category} 
                                   <button class='deletbutton' onclick=deleteExpense('${user.discription}')> Delete Expense </button>
                                   <button class='editbutton' onclick=editExpenseDetails('${user.discription}','${user.addAmount}','${user.category}')>Edit Expense </button>
                                </li>`

           parentNode.innerHTML = parentNode.innerHTML + childHTML;
       }
       // Edit expense details
       function editExpenseDetails(addDiscription, amount, category ){
           document.getElementById('discription').value = addDiscription;
           document.getElementById('amount').value = amount;
           document.getElementById('category').value = category;
         

           deleteExpense(addDiscription);


       }

       // deleteEpense

       function deleteExpense(addDiscription){
           console.log(addDiscription)
           localStorage.removeItem(addDiscription);
           removeUserFromScreen(addDiscription);

       }

       function removeUserFromScreen(addDiscription){
           const parentNode = document.getElementById('listOfExpenses');
           const childNodeToBeDeleted = document.getElementById(addDiscription);

           parentNode.removeChild(childNodeToBeDeleted)
       }

   </script>  

</body>
</html>